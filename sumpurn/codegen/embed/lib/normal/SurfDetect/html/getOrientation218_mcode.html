<!-- saved from url=(0014)about:internet -->
<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="80,1" id="srcline1">  1</a></span><span class="line">function intPoints = OrientationCalc(intImage, intPoints) <span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,2" id="srcline2">  2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%   Copyright 2017 The MathWorks, Inc.</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,5" id="srcline5">  5</a></span><span class="line"><span class="comment">% This function computes orientation needed for rotation invariance for</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,6" id="srcline6">  6</a></span><span class="line"><span class="comment">% each of the extracted interest point. The orientation is computed by</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,7" id="srcline7">  7</a></span><span class="line"><span class="comment">% convolution with Haar wavelets of size 4s for pixels that are within a</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,8" id="srcline8">  8</a></span><span class="line"><span class="comment">% radius of 6s where 's' is the scale at which the interest point was detected</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,9" id="srcline9">  9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,10" id="srcline10"> 10</a></span><span class="line">coder.gpu.kernelfun();</span></span>
<span class="srcline"><span class="lineno"><a href="80,11" id="srcline11"> 11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,12" id="srcline12"> 12</a></span><span class="line">numPoints = length(intPoints);</span></span>
<span class="srcline"><span class="lineno"><a href="80,13" id="srcline13"> 13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,14" id="srcline14"> 14</a></span><span class="line">for i = 1:numPoints</span></span>
<span class="srcline"><span class="lineno"><a href="80,15" id="srcline15"> 15</a></span><span class="line">    ipt = intPoints(i);</span></span>
<span class="srcline"><span class="lineno"><a href="80,16" id="srcline16"> 16</a></span><span class="line">    intPoints(i).orientation = getOrientation(intImage, ipt);</span></span>
<span class="srcline"><span class="lineno"><a href="80,17" id="srcline17"> 17</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,18" id="srcline18"> 18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,19" id="srcline19"> 19</a></span><span class="line">end</span></span>
</pre>
</div>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="80,20" id="srcline20"> 20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,21" id="srcline21"> 21</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S11T2U46">orient</span> = getOrientation(<span class="var type1" id="S12T5U49">intImage</span>, <span class="var type1" id="S13T64U50">obj</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="80,22" id="srcline22"> 22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">% Calculate orientation for a given interest point</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,24" id="srcline24"> 24</a></span><span class="line"><span class="mxinfo " id="T75:U4"><span class="var type1" id="S14T75U53">fRound</span> = <span class="mxinfo " id="T75:U6">@(value) double(floor(value+single(0.5)))</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,25" id="srcline25"> 25</a></span><span class="line"><span class="mxinfo " id="T2:U7"><span class="var type1" id="S11T2U67">orient</span> = <span class="mxinfo " id="T2:U9">single(<span class="mxinfo " id="T7:U10">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,26" id="srcline26"> 26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo " id="T76:U11"><span class="var type1" id="S18T76U73">gauss25</span> = <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,28" id="srcline28"> 28</a></span><span class="line">    <span class="mxinfo " id="T76:U13">[ 0.02546481,	0.02350698,	0.01849125,	0.01239505,	0.00708017,	0.00344629,	0.00142946;</span></span>
<span class="srcline"><span class="lineno"><a href="80,29" id="srcline29"> 29</a></span><span class="line">    0.02350698,	0.02169968,	0.01706957,	0.01144208,	0.00653582,	0.00318132,	0.00131956;</span></span>
<span class="srcline"><span class="lineno"><a href="80,30" id="srcline30"> 30</a></span><span class="line">    0.01849125,	0.01706957,	0.01342740,	0.00900066,	0.00514126,	0.00250252,	0.00103800;</span></span>
<span class="srcline"><span class="lineno"><a href="80,31" id="srcline31"> 31</a></span><span class="line">    0.01239505,	0.01144208,	0.00900066,	0.00603332,	0.00344629,	0.00167749,	0.00069579;</span></span>
<span class="srcline"><span class="lineno"><a href="80,32" id="srcline32"> 32</a></span><span class="line">    0.00708017,	0.00653582,	0.00514126,	0.00344629,	0.00196855,	0.00095820,	0.00039744;</span></span>
<span class="srcline"><span class="lineno"><a href="80,33" id="srcline33"> 33</a></span><span class="line">    0.00344629,	0.00318132,	0.00250252,	0.00167749,	0.00095820,	0.00046640,	0.00019346;</span></span>
<span class="srcline"><span class="lineno"><a href="80,34" id="srcline34"> 34</a></span><span class="line">    0.00142946,	0.00131956,	0.00103800,	0.00069579,	0.00039744,	0.00019346,	0.00008024]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,35" id="srcline35"> 35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,36" id="srcline36"> 36</a></span><span class="line"><span class="mxinfo " id="T7:U14"><span class="var type1" id="S19T7U133">or_s</span> = <span class="mxinfo " id="T7:U16"><span class="mxinfo " id="T75:U17"><span class="fcn" id="F196N13:B75">fRound</span></span>(<span class="mxinfo " id="T2:U18"><span class="var type1" id="S13T64U137">obj</span>.scale</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,37" id="srcline37"> 37</a></span><span class="line"><span class="mxinfo " id="T7:U20"><span class="var type1" id="S20T7U141">or_r</span> = <span class="mxinfo " id="T7:U22"><span class="mxinfo " id="T75:U23"><span class="fcn" id="F196N13:B75">fRound</span></span>(<span class="mxinfo " id="T2:U24"><span class="var type1" id="S13T64U145">obj</span>.y</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,38" id="srcline38"> 38</a></span><span class="line"><span class="mxinfo " id="T7:U26"><span class="var type1" id="S21T7U149">or_c</span> = <span class="mxinfo " id="T7:U28"><span class="mxinfo " id="T75:U29"><span class="fcn" id="F196N13:B75">fRound</span></span>(<span class="mxinfo " id="T2:U30"><span class="var type1" id="S13T64U153">obj</span>.x</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,39" id="srcline39"> 39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,40" id="srcline40"> 40</a></span><span class="line"><span class="mxinfo " id="T77:U32"><span class="var type1" id="S22T77U157">id</span> = <span class="mxinfo " id="T77:U34">[6,5,4,3,2,1,0,1,2,3,4,5,6]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,41" id="srcline41"> 41</a></span><span class="line"><span class="mxinfo " id="T7:U35"><span class="var type1" id="S23T7U175">idx</span> = <span class="mxinfo " id="T7:U37">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,42" id="srcline42"> 42</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,43" id="srcline43"> 43</a></span><span class="line"><span class="mxinfo " id="T78:U38"><span class="var type1" id="S24T78U179">resX</span> = <span class="mxinfo " id="T78:U40">zeros(<span class="mxinfo " id="T7:U41">1</span>,<span class="mxinfo " id="T7:U42">109</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,44" id="srcline44"> 44</a></span><span class="line"><span class="mxinfo " id="T78:U43"><span class="var type1" id="S26T78U186">resY</span> = <span class="mxinfo " id="T78:U45">zeros(<span class="mxinfo " id="T7:U46">1</span>,<span class="mxinfo " id="T7:U47">109</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,45" id="srcline45"> 45</a></span><span class="line"><span class="mxinfo " id="T78:U48"><span class="var type1" id="S27T78U193">Ang</span>  = <span class="mxinfo " id="T78:U50">zeros(<span class="mxinfo " id="T7:U51">1</span>,<span class="mxinfo " id="T7:U52">109</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,46" id="srcline46"> 46</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">% calculate haar wavelet responses for points within radius of 6*scale</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,48" id="srcline48"> 48</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S28T7U200">ii</span> = <span class="mxinfo " id="T7:U54">-6</span>:6</span></span>
<span class="srcline"><span class="lineno"><a href="80,49" id="srcline49"> 49</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S29T7U207">jj</span> = <span class="mxinfo " id="T7:U56">-6</span>:6</span></span>
<span class="srcline"><span class="lineno"><a href="80,50" id="srcline50"> 50</a></span><span class="line">        <span class="keyword">if</span>(<span class="mxinfo " id="T11:U57"><span class="mxinfo " id="T7:U58"><span class="mxinfo " id="T7:U59"><span class="var type1" id="S28T7U218">ii</span>*<span class="var type1" id="S28T7U219">ii</span></span> + <span class="mxinfo " id="T7:U62"><span class="var type1" id="S29T7U221">jj</span>*<span class="var type1" id="S29T7U222">jj</span></span></span> &lt; <span class="mxinfo " id="T7:U65">36</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="80,51" id="srcline51"> 51</a></span><span class="line">            <span class="mxinfo " id="T2:U66"><span class="var type1" id="S30T2U226">gauss</span> = <span class="mxinfo " id="T2:U68">single(<span class="mxinfo " id="T7:U69"><span class="var type1" id="S18T76U230">gauss25</span>(<span class="mxinfo " id="T7:U71"><span class="mxinfo " id="T7:U72"><span class="var type1" id="S22T77U233">id</span>(<span class="mxinfo " id="T7:U74"><span class="var type1" id="S28T7U235">ii</span>+<span class="mxinfo " id="T7:U76">7</span></span>)</span>+<span class="mxinfo " id="T7:U77">1</span></span>,<span class="mxinfo " id="T7:U78"><span class="mxinfo " id="T7:U79"><span class="var type1" id="S22T77U240">id</span>(<span class="mxinfo " id="T7:U81"><span class="var type1" id="S29T7U242">jj</span>+<span class="mxinfo " id="T7:U83">7</span></span>)</span>+<span class="mxinfo " id="T7:U84">1</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,52" id="srcline52"> 52</a></span><span class="line">            <span class="mxinfo " id="T7:U85"><span class="mxinfo " id="T7:U86"><span class="var type1" id="S24T78U248">resX</span>(<span class="mxinfo " id="T7:U88"><span class="var type1" id="S23T7U249"><span class="potentialdiff PD1">idx</span></span></span>)</span> = <span class="mxinfo " id="T2:U89"><span class="var type1" id="S30T2U251">gauss</span> * <span class="mxinfo " id="T2:U91"><span class="fcn" id="F198N16:B253">haarX</span>(<span class="var type1" id="S12T5U254">intImage</span>, <span class="mxinfo " id="T7:U93"><span class="var type1" id="S20T7U256">or_r</span> + <span class="mxinfo " id="T7:U95"><span class="var type1" id="S29T7U258">jj</span> * <span class="var type1" id="S19T7U259">or_s</span></span></span>, <span class="mxinfo " id="T7:U98"><span class="var type1" id="S21T7U261">or_c</span> +<span class="mxinfo " id="T7:U100"><span class="var type1" id="S28T7U263">ii</span> * <span class="var type1" id="S19T7U264">or_s</span></span></span>, <span class="mxinfo " id="T7:U103"><span class="mxinfo " id="T7:U104">4</span> * <span class="var type1" id="S19T7U267">or_s</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,53" id="srcline53"> 53</a></span><span class="line">            <span class="mxinfo " id="T7:U106"><span class="mxinfo " id="T7:U107"><span class="var type1" id="S26T78U271">resY</span>(<span class="var type1" id="S23T7U272">idx</span>)</span> = <span class="mxinfo " id="T2:U110"><span class="var type1" id="S30T2U274">gauss</span> * <span class="mxinfo " id="T2:U112"><span class="fcn" id="F199N17:B276">haarY</span>(<span class="var type1" id="S12T5U277">intImage</span>, <span class="mxinfo " id="T7:U114"><span class="var type1" id="S20T7U279">or_r</span> + <span class="mxinfo " id="T7:U116"><span class="var type1" id="S29T7U281">jj</span> * <span class="var type1" id="S19T7U282">or_s</span></span></span>, <span class="mxinfo " id="T7:U119"><span class="var type1" id="S21T7U284">or_c</span> +<span class="mxinfo " id="T7:U121"><span class="var type1" id="S28T7U286">ii</span> * <span class="var type1" id="S19T7U287">or_s</span></span></span>, <span class="mxinfo " id="T7:U124"><span class="mxinfo " id="T7:U125">4</span> * <span class="var type1" id="S19T7U290">or_s</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,54" id="srcline54"> 54</a></span><span class="line">            <span class="mxinfo " id="T7:U127"><span class="mxinfo " id="T7:U128"><span class="var type1" id="S27T78U294">Ang</span>(<span class="var type1" id="S23T7U295">idx</span>)</span> = <span class="mxinfo " id="T2:U131"><span class="fcn" id="F203N14:B297">getAngle</span>(<span class="mxinfo " id="T7:U132"><span class="var type1" id="S24T78U299">resX</span>(<span class="var type1" id="S23T7U300">idx</span>)</span>, <span class="mxinfo " id="T7:U135"><span class="var type1" id="S26T78U302">resY</span>(<span class="var type1" id="S23T7U303">idx</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,55" id="srcline55"> 55</a></span><span class="line">            <span class="mxinfo " id="T7:U138"><span class="var type1" id="S23T7U306">idx</span> = <span class="mxinfo " id="T7:U140"><span class="var type1" id="S23T7U308">idx</span> + <span class="mxinfo " id="T7:U142">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,56" id="srcline56"> 56</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,57" id="srcline57"> 57</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,58" id="srcline58"> 58</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,59" id="srcline59"> 59</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">% Calculate the dominant direction by rotating a pi/3 sector window around interest point</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,61" id="srcline61"> 61</a></span><span class="line"><span class="mxinfo " id="T7:U143"><span class="var type1" id="S34T7U312">len</span> = <span class="mxinfo " id="T7:U145">length(<span class="var type1" id="S27T78U315">Ang</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,62" id="srcline62"> 62</a></span><span class="line"><span class="mxinfo " id="T2:U147"><span class="var type1" id="S36T2U318">ang1</span> = <span class="mxinfo " id="T2:U149">single(<span class="mxinfo " id="T7:U150">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,63" id="srcline63"> 63</a></span><span class="line"><span class="mxinfo " id="T2:U151"><span class="var type1" id="S37T2U324">max</span> = <span class="mxinfo " id="T2:U153">single(<span class="mxinfo " id="T7:U154">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,64" id="srcline64"> 64</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,65" id="srcline65"> 65</a></span><span class="line"><span class="keyword">while</span> <span class="mxinfo " id="T11:U155"><span class="var type1" id="S36T2U330">ang1</span> &lt; <span class="mxinfo " id="T7:U157"><span class="mxinfo " id="T7:U158">2</span> * <span class="mxinfo " id="T7:U159">pi</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="80,66" id="srcline66"> 66</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo " id="T11:U160"><span class="mxinfo " id="T2:U161"><span class="var type1" id="S36T2U340">ang1</span> + <span class="mxinfo " id="T2:U163"><span class="mxinfo " id="T7:U164">pi</span>/<span class="mxinfo " id="T2:U165">single(3.0)</span></span></span> &gt; <span class="mxinfo " id="T7:U166"><span class="mxinfo " id="T7:U167">2</span> * <span class="mxinfo " id="T7:U168">pi</span></span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="80,67" id="srcline67"> 67</a></span><span class="line">        <span class="mxinfo " id="T2:U169"><span class="var type1" id="S39T2U353">ang2</span> = <span class="mxinfo " id="T2:U171"><span class="var type1" id="S36T2U355">ang1</span> - <span class="mxinfo " id="T2:U173"><span class="mxinfo " id="T2:U174">single(5.0) * pi</span>/<span class="mxinfo " id="T2:U175">single(3.0)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,68" id="srcline68"> 68</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,69" id="srcline69"> 69</a></span><span class="line">        <span class="mxinfo " id="T2:U176"><span class="var type1" id="S39T2U369">ang2</span> = <span class="mxinfo " id="T2:U178"><span class="var type1" id="S36T2U371">ang1</span> + <span class="mxinfo " id="T2:U180"><span class="mxinfo " id="T7:U181">pi</span>/<span class="mxinfo " id="T2:U182">single(3.0)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,70" id="srcline70"> 70</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,71" id="srcline71"> 71</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="80,72" id="srcline72"> 72</a></span><span class="line">    <span class="mxinfo " id="T2:U183"><span class="var type1" id="S40T2U380">sumX</span> = <span class="mxinfo " id="T2:U185">single(<span class="mxinfo " id="T7:U186">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,73" id="srcline73"> 73</a></span><span class="line">    <span class="mxinfo " id="T2:U187"><span class="var type1" id="S41T2U386">sumY</span> = <span class="mxinfo " id="T2:U189">single(<span class="mxinfo " id="T7:U190">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,74" id="srcline74"> 74</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="80,75" id="srcline75"> 75</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S42T7U392">k</span> = <span class="mxinfo " id="T7:U192">1</span>:<span class="var type1" id="S34T7U395">len</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,76" id="srcline76"> 76</a></span><span class="line">        <span class="comment">%  get angle of the interest point</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,77" id="srcline77"> 77</a></span><span class="line">        <span class="mxinfo " id="T7:U194"><span class="var type1" id="S43T7U398">ang</span> = <span class="mxinfo " id="T7:U196"><span class="var type1" id="S27T78U400">Ang</span>(<span class="var type1" id="S42T7U401">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,78" id="srcline78"> 78</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="80,79" id="srcline79"> 79</a></span><span class="line">        <span class="comment">% determine whether the point is within the window</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,80" id="srcline80"> 80</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo " id="T11:U199"><span class="var type1" id="S36T2U408">ang1</span> &lt; <span class="var type1" id="S39T2U409">ang2</span></span> &amp;&amp; <span class="mxinfo " id="T11:U202"><span class="var type1" id="S36T2U411">ang1</span> &lt; <span class="var type1" id="S43T7U412">ang</span></span> &amp;&amp; <span class="mxinfo " id="T11:U205"><span class="var type1" id="S43T7U414">ang</span> &lt; <span class="var type1" id="S39T2U415">ang2</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="80,81" id="srcline81"> 81</a></span><span class="line">            <span class="mxinfo " id="T2:U208"><span class="var type1" id="S40T2U418">sumX</span> = <span class="mxinfo " id="T2:U210"><span class="var type1" id="S40T2U420">sumX</span> + <span class="mxinfo " id="T7:U212"><span class="var type1" id="S24T78U422">resX</span>(<span class="var type1" id="S42T7U423">k</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,82" id="srcline82"> 82</a></span><span class="line">            <span class="mxinfo " id="T2:U215"><span class="var type1" id="S41T2U426">sumY</span> = <span class="mxinfo " id="T2:U217"><span class="var type1" id="S41T2U428">sumY</span> + <span class="mxinfo " id="T7:U219"><span class="var type1" id="S26T78U430">resY</span>(<span class="var type1" id="S42T7U431">k</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,83" id="srcline83"> 83</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,84" id="srcline84"> 84</a></span><span class="line">            <span class="keyword">if</span> (<span class="mxinfo " id="T11:U222"><span class="var type1" id="S39T2U438">ang2</span> &lt; <span class="var type1" id="S36T2U439">ang1</span></span> &amp;&amp; <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,85" id="srcline85"> 85</a></span><span class="line">                    ((<span class="mxinfo " id="T11:U225"><span class="var type1" id="S43T7U445">ang</span> &gt; <span class="mxinfo " id="T7:U227">0</span></span> &amp;&amp; <span class="mxinfo " id="T11:U228"><span class="var type1" id="S43T7U448">ang</span> &lt; <span class="var type1" id="S39T2U449">ang2</span></span>) || (<span class="mxinfo " id="T11:U231"><span class="var type1" id="S43T7U453">ang</span> &gt; <span class="var type1" id="S36T2U454">ang1</span></span> &amp;&amp; <span class="mxinfo " id="T11:U234"><span class="var type1" id="S43T7U456">ang</span> &lt; <span class="mxinfo " id="T7:U236"><span class="mxinfo " id="T7:U237">2</span>*<span class="mxinfo " id="T7:U238">pi</span></span></span>) ))</span></span>
<span class="srcline"><span class="lineno"><a href="80,86" id="srcline86"> 86</a></span><span class="line">                <span class="mxinfo " id="T2:U239"><span class="var type1" id="S40T2U463">sumX</span> = <span class="mxinfo " id="T2:U241"><span class="var type1" id="S40T2U465">sumX</span> + <span class="mxinfo " id="T7:U243"><span class="var type1" id="S24T78U467">resX</span>(<span class="var type1" id="S42T7U468">k</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,87" id="srcline87"> 87</a></span><span class="line">                <span class="mxinfo " id="T2:U246"><span class="var type1" id="S41T2U471">sumY</span> = <span class="mxinfo " id="T2:U248"><span class="var type1" id="S41T2U473">sumY</span> + <span class="mxinfo " id="T7:U250"><span class="var type1" id="S26T78U475">resY</span>(<span class="var type1" id="S42T7U476">k</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,88" id="srcline88"> 88</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,89" id="srcline89"> 89</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,90" id="srcline90"> 90</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="80,91" id="srcline91"> 91</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,92" id="srcline92"> 92</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="80,93" id="srcline93"> 93</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="80,94" id="srcline94"> 94</a></span><span class="line">    <span class="comment">% if the vector produced from this window is longer than all previous vectors then this forms the new dominant direction</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,95" id="srcline95"> 95</a></span><span class="line">    <span class="keyword">if</span> (<span class="mxinfo " id="T11:U253"><span class="mxinfo " id="T2:U254"><span class="mxinfo " id="T2:U255"><span class="var type1" id="S40T2U483">sumX</span>*<span class="var type1" id="S40T2U484">sumX</span></span> + <span class="mxinfo " id="T2:U258"><span class="var type1" id="S41T2U486">sumY</span>*<span class="var type1" id="S41T2U487">sumY</span></span></span> &gt; <span class="var type1" id="S37T2U488">max</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="80,96" id="srcline96"> 96</a></span><span class="line">        <span class="comment">% store largest orientation</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,97" id="srcline97"> 97</a></span><span class="line">        <span class="mxinfo " id="T2:U262"><span class="var type1" id="S37T2U491">max</span> = <span class="mxinfo " id="T2:U264"><span class="mxinfo " id="T2:U265"><span class="var type1" id="S40T2U494">sumX</span>*<span class="var type1" id="S40T2U495">sumX</span></span> + <span class="mxinfo " id="T2:U268"><span class="var type1" id="S41T2U497">sumY</span>*<span class="var type1" id="S41T2U498">sumY</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,98" id="srcline98"> 98</a></span><span class="line">        <span class="mxinfo " id="T2:U271"><span class="var type1" id="S11T2U501">orient</span> = <span class="mxinfo " id="T2:U273"><span class="fcn" id="F217N14:B503">getAngle</span>(<span class="var type1" id="S40T2U504">sumX</span>,<span class="var type1" id="S41T2U505">sumY</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,99" id="srcline99"> 99</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,100" id="srcline100">100</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="80,101" id="srcline101">101</a></span><span class="line">    <span class="mxinfo " id="T2:U276"><span class="var type1" id="S36T2U508">ang1</span> = <span class="mxinfo " id="T2:U278"><span class="var type1" id="S36T2U510">ang1</span> + <span class="mxinfo " id="T2:U280">single(<span class="mxinfo " id="T7:U281">0.15</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,102" id="srcline102">102</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,103" id="srcline103">103</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,104" id="srcline104">104</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,105" id="srcline105">105</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,106" id="srcline106">106</a></span><span class="line"></span></span>
</pre>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="80,107" id="srcline107">107</a></span><span class="line">function res = haarX(intImage, row,column,s)</span></span>
<span class="srcline"><span class="lineno"><a href="80,108" id="srcline108">108</a></span><span class="line">res = BoxIntegral(intImage, row-s/2, column, s, s/2) ...</span></span>
<span class="srcline"><span class="lineno"><a href="80,109" id="srcline109">109</a></span><span class="line">    -1 * BoxIntegral(intImage, row-s/2, column-s/2, s, s/2);</span></span>
<span class="srcline"><span class="lineno"><a href="80,110" id="srcline110">110</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,111" id="srcline111">111</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,112" id="srcline112">112</a></span><span class="line">function res = haarY(intImage, row,column,s)</span></span>
<span class="srcline"><span class="lineno"><a href="80,113" id="srcline113">113</a></span><span class="line">res = BoxIntegral(intImage, row, column-s/2, s/2, s) ...</span></span>
<span class="srcline"><span class="lineno"><a href="80,114" id="srcline114">114</a></span><span class="line">    -1 * BoxIntegral(intImage, row-s/2, column-s/2, s/2, s);</span></span>
<span class="srcline"><span class="lineno"><a href="80,115" id="srcline115">115</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,116" id="srcline116">116</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,117" id="srcline117">117</a></span><span class="line">function result = getAngle(X,Y)</span></span>
<span class="srcline"><span class="lineno"><a href="80,118" id="srcline118">118</a></span><span class="line">if(X &gt; 0 &amp;&amp; Y &gt;= 0)</span></span>
<span class="srcline"><span class="lineno"><a href="80,119" id="srcline119">119</a></span><span class="line">    result =  atan(Y/X);</span></span>
<span class="srcline"><span class="lineno"><a href="80,120" id="srcline120">120</a></span><span class="line">    result = single(result);</span></span>
<span class="srcline"><span class="lineno"><a href="80,121" id="srcline121">121</a></span><span class="line">    return;</span></span>
<span class="srcline"><span class="lineno"><a href="80,122" id="srcline122">122</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,123" id="srcline123">123</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,124" id="srcline124">124</a></span><span class="line">if(X &lt; 0 &amp;&amp; Y &gt;= 0)</span></span>
<span class="srcline"><span class="lineno"><a href="80,125" id="srcline125">125</a></span><span class="line">    result =  pi - atan(-Y/X);</span></span>
<span class="srcline"><span class="lineno"><a href="80,126" id="srcline126">126</a></span><span class="line">    result = single(result);</span></span>
<span class="srcline"><span class="lineno"><a href="80,127" id="srcline127">127</a></span><span class="line">    return;</span></span>
<span class="srcline"><span class="lineno"><a href="80,128" id="srcline128">128</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,129" id="srcline129">129</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,130" id="srcline130">130</a></span><span class="line">if(X &lt; 0 &amp;&amp; Y &lt; 0)</span></span>
<span class="srcline"><span class="lineno"><a href="80,131" id="srcline131">131</a></span><span class="line">    result =  pi + atan(Y/X);</span></span>
<span class="srcline"><span class="lineno"><a href="80,132" id="srcline132">132</a></span><span class="line">    result = single(result);</span></span>
<span class="srcline"><span class="lineno"><a href="80,133" id="srcline133">133</a></span><span class="line">    return;</span></span>
<span class="srcline"><span class="lineno"><a href="80,134" id="srcline134">134</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,135" id="srcline135">135</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,136" id="srcline136">136</a></span><span class="line">if(X &gt; 0 &amp;&amp; Y &lt; 0)</span></span>
<span class="srcline"><span class="lineno"><a href="80,137" id="srcline137">137</a></span><span class="line">    result =  2*pi - atan(-Y/X);</span></span>
<span class="srcline"><span class="lineno"><a href="80,138" id="srcline138">138</a></span><span class="line">    result = single(result);</span></span>
<span class="srcline"><span class="lineno"><a href="80,139" id="srcline139">139</a></span><span class="line">    return;</span></span>
<span class="srcline"><span class="lineno"><a href="80,140" id="srcline140">140</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,141" id="srcline141">141</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,142" id="srcline142">142</a></span><span class="line">result = single(0);</span></span>
<span class="srcline"><span class="lineno"><a href="80,143" id="srcline143">143</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,144" id="srcline144">144</a></span><span class="line">end</span></span>
<span class="srcline"><span class="lineno"><a href="80,145" id="srcline145">145</a></span><span class="line"> </span></span>
</pre>
</div>
</body>
</html>
